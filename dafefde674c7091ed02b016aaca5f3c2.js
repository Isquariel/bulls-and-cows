!function(t){function e(t,e){var i,s,o="",r=t;for(s=0;e>s;s++)i=r[Math.floor(Math.random()*r.length)],r=r.replace(i,""),o+=i;return o.charAt(0)===t.charAt(0)&&(o=o.slice(1)+t.charAt(0)),o}function i(t){var e={};return t.split("").every(function(t){return e[t]?!1:e[t]=!0})}function s(t,e,s){return new RegExp("^["+e+"]{"+s+"}$").test(t)&&i(t)}function o(t,e){var i,s,o=0,r=0,n=t.length;for(i=0;n>i;i++)for(s=0;n>s;s++)t[i]===e[s]&&(i===s?r++:o++);return{bulls:r,cows:o}}function r(t){this._base=r.BASE,this._length=r.LENGTH,t&&this.isValid(t)?this._secret=t:this._secret=e(this._base,this._length)}function n(){t.localStorage?(this.set=function(e,i){return t.localStorage.setItem(e,i)},this.get=function(e,i){return t.localStorage.getItem(e,i)},this.clear=function(){return t.localStorage.clear()}):(this.set=this.stub,this.get=this.stub,this.clear=this.stub)}function h(){this.initComponents(),this.initStorage(),this.initGame()}r.BASE="0123456789",r.LENGTH=4,r.prototype.getSecret=function(){return this._secret},r.prototype.isValid=function(t){return s(t,this._base,this._length)},r.prototype.check=function(t){var e;return this.isValid(t)?(e=o(this._secret,t),e.bulls===t.length&&(e.win=t),e):{invalid:t}},n.prototype.stub=function(){},h.prototype.initStorage=function(){this._storage=new n,this.getHistory().forEach(function(t){this.output.appendChild(this.getItemElem.apply(this,t))},this),this.guess.value=this._storage.get("guess")||""},h.prototype.initComponents=function(){this.form=document.forms.puzzle,this.guess=this.form.elements.guess,this.output=this.form.querySelector(".output"),this.form.addEventListener("submit",this.onFormSubmit.bind(this),!1),this.form.addEventListener("reset",this.reset.bind(this),!1),this.guess.addEventListener("keyup",this.saveGuess.bind(this),!1)},h.prototype.initGame=function(){this._game=new r(this._storage.get("secret")),this._storage.set("secret",this._game.getSecret())},h.prototype.onFormSubmit=function(t){var e=this.guess.value,i=this._game.check(e);if(t.preventDefault(),""!==e.replace(/\s+/,"")&&!this.isUsed(e)){if(this.guess.value="",this.guess.focus(),Object.prototype.hasOwnProperty.call(i,"invalid"))return void this.onInvalidInput(i.invalid);this.isUiFrozen()||this.addItem(e,i),i.win&&this.onWin()}},h.prototype.onInvalidInput=function(t){alert("The guess "+t+" is invalid")},h.prototype.onWin=function(){this.reachGoal("GAME_WIN",{attempts:this.getHistory().length}),confirm("You win! Start a new game?")?(this.clear(),this.initGame()):this.freezeUi()},h.prototype.saveGuess=function(){this._storage.set("guess",this.guess.value.replace(/\s+/g,""))},h.prototype.reset=function(){this.clear(),this.initGame(),this.reachGoal("RESET")},h.prototype.clear=function(){this.output.innerHTML="",this.guess.value="",this._storage.clear(),this.guess.focus()},h.prototype.addItem=function(t,e){var i=this.getHistory();i.unshift([t,e]),this.saveHistory(i),this.markUsed(t),this.output.insertBefore(this.getItemElem(t,e),this.output.firstChild)},h.prototype.getItemElem=function(t,e){var i=document.createElement("li");return i.innerHTML=t+": "+e.bulls+"b "+e.cows+"c",i},h.prototype.freezeUi=function(){this._frozen=!0},h.prototype.isUiFrozen=function(){return Boolean(this._frozen)},h.prototype.getHistory=function(){var t;if(this._history)return this._history;try{t=JSON.parse(this._storage.get("history"))}catch(e){t=[]}return this._history=[].concat(t).filter(Boolean),this._used={},this._history.forEach(function(t){this.markUsed(t[0])},this),this._history},h.prototype.isUsed=function(t){return Boolean(this._used[String(t)])},h.prototype.markUsed=function(t){this._used[String(t)]=!0},h.prototype.saveHistory=function(t){this._storage.set("history",JSON.stringify(t.filter(Boolean)))},h.prototype.reachGoal=function(){var e=t.yaCounter32909025;e&&e.reachGoal.apply(e,arguments)},t.UI=h}(window);