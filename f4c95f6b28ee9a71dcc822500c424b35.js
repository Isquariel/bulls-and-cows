!function(t){function i(t,i){var e,s,o="",n=t;for(s=0;i>s;s++)e=n[Math.floor(Math.random()*n.length)],n=n.replace(e,""),o+=e;return o.charAt(0)===t.charAt(0)&&(o=o.slice(1)+t.charAt(0)),o}function e(t){var i={};return t.split("").every(function(t){return i[t]?!1:i[t]=!0})}function s(t,i,s){return new RegExp("^["+i+"]{"+s+"}$").test(t)&&e(t)}function o(t,i){var e,s,o=0,n=0,r=t.length;for(e=0;r>e;e++)for(s=0;r>s;s++)t[e]===i[s]&&(e===s?n++:o++);return{bulls:n,cows:o}}function n(t){this._base=n.BASE,this._length=n.LENGTH,t&&this.isValid(t)?this._secret=t:this._secret=i(this._base,this._length)}function r(){t.localStorage?(this.set=function(i,e){return t.localStorage.setItem(i,e)},this.get=function(i,e){return t.localStorage.getItem(i,e)},this.clear=function(){return t.localStorage.clear()}):(this.set=this.stub,this.get=this.stub,this.clear=this.stub)}function h(){this.initComponents(),this.initStorage(),this.initGame()}n.BASE="0123456789",n.LENGTH=4,n.prototype.getSecret=function(){return this._secret},n.prototype.isValid=function(t){return s(t,this._base,this._length)},n.prototype.check=function(t){var i;return this.isValid(t)?(i=o(this._secret,t),i.bulls===t.length&&(i.win=t),i):{invalid:t}},r.prototype.stub=function(){},h.prototype.initStorage=function(){this._storage=new r,this.getHistory().forEach(function(t){this.output.appendChild(this.getItemElem.apply(this,t))},this),this.guess.value=this._storage.get("guess")||""},h.prototype.initComponents=function(){this.form=document.forms.puzzle,this.guess=this.form.elements.guess,this.output=this.form.querySelector(".output"),this.form.addEventListener("submit",this.onFormSubmit.bind(this),!1),this.form.addEventListener("reset",this.reset.bind(this),!1),this.guess.addEventListener("keyup",this.onChange.bind(this),!1)},h.prototype.initGame=function(){this._game=new n(this._storage.get("secret")),this._storage.set("secret",this._game.getSecret())},h.prototype.onFormSubmit=function(t){var i=this.guess.value,e=this._game.check(i);if(t.preventDefault(),""!==i.replace(/\s+/,"")&&!this.isUsed(i)){if(Object.prototype.hasOwnProperty.call(e,"invalid"))return this.onInvalidInput(e.invalid),void this.guess.focus();this.guess.value="",this.guess.focus(),this.addItem(i,e),e.win&&this.onWin()}},h.prototype.onInvalidInput=function(t){this.showNotification("error","The guess "+t.slice(0,this._length)+" is invalid")},h.prototype.onWin=function(){this.reachGoal("GAME_WIN",{attempts:this.getHistory().length}),confirm("You win! Start a new game?")?(this.clear(),this.initGame()):this.freezeUi()},h.prototype.onChange=function(t){this.saveGuess(),13!==t.keyCode&&this.hideNotifications()},h.prototype.saveGuess=function(){this._storage.set("guess",this.guess.value.replace(/\s+/g,""))},h.prototype.reset=function(){this.clear(),this.initGame(),this.reachGoal("RESET")},h.prototype.clear=function(){this.output.innerHTML="",this.guess.value="",this._storage.clear(),this.guess.focus(),this.unfreeze()},h.prototype.addItem=function(t,i){var e=this.getHistory();this.isUiFrozen()||(e.unshift([t,i]),this.saveHistory(e),this.markUsed(t),this.output.insertBefore(this.getItemElem(t,i),this.output.firstChild))},h.prototype.getItemElem=function(t,i){var e=document.createElement("li");return e.innerHTML=t+": "+i.bulls+"b "+i.cows+"c",e},h.prototype.freezeUi=function(){this._frozen=!0},h.prototype.unfreeze=function(){this._frozen=!1},h.prototype.isUiFrozen=function(){return Boolean(this._frozen)},h.prototype.getHistory=function(){var t;if(this._history)return this._history;try{t=JSON.parse(this._storage.get("history"))}catch(i){t=[]}return this._history=[].concat(t).filter(Boolean),this._used={},this._history.forEach(function(t){this.markUsed(t[0])},this),this._history},h.prototype.isUsed=function(t){return Boolean(this._used[String(t)])},h.prototype.markUsed=function(t){this._used[String(t)]=!0},h.prototype.saveHistory=function(t){this._storage.set("history",JSON.stringify(t.filter(Boolean)))},h.prototype.showNotification=function(i,e){if(!this.isUiFrozen()){this.hideNotifications();var s=document.createElement("div");s.classList.add("notification"),s.innerHTML=e,this.getNotificationContainer().appendChild(s),t.requestAnimationFrame(function(){s.classList.add("notification-"+i)})}},h.prototype.hideNotifications=function(){this.getNotificationContainer().innerHTML=""},h.prototype.getNotificationContainer=function(){return this._notificationContainer||(this._notificationContainer=document.querySelector(".notification-container"))},h.prototype.reachGoal=function(){var i=t.yaCounter32909025;i&&i.reachGoal.apply(i,arguments)},t.UI=h}(window);