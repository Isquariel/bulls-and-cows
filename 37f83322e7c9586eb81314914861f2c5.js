!function(t){function e(t,e){var i,s,o="",n=t;for(s=0;e>s;s++)i=n[Math.floor(Math.random()*n.length)],n=n.replace(i,""),o+=i;return o.charAt(0)===t.charAt(0)&&(o=o.slice(1)+t.charAt(0)),o}function i(t){var e={};return t.split("").every(function(t){return e[t]?!1:e[t]=!0})}function s(t,e,s){return new RegExp("^["+e+"]{"+s+"}$").test(t)&&i(t)}function o(t,e){var i,s,o=0,n=0,r=t.length;for(i=0;r>i;i++)for(s=0;r>s;s++)t[i]===e[s]&&(i===s?n++:o++);return{bulls:n,cows:o}}function n(t){this._base=n.BASE,this._length=n.LENGTH,t&&this.isValid(t)?this._secret=t:this._secret=e(this._base,this._length),console&&console.log&&console.log(this._secret)}function r(){t.localStorage?(this.set=function(e,i){return t.localStorage.setItem(e,i)},this.get=function(e,i){return t.localStorage.getItem(e,i)},this.clear=function(){return t.localStorage.clear()}):(this.set=this.stub,this.get=this.stub,this.clear=this.stub)}function h(){this.initComponents(),this.initStorage(),this.initGame()}n.BASE="0123456789",n.LENGTH=4,n.prototype.getSecret=function(){return this._secret},n.prototype.isValid=function(t){return s(t,this._base,this._length)},n.prototype.check=function(t){var e;return this.isValid(t)?(e=o(this._secret,t),e.bulls===t.length&&(e.win=t),e):{invalid:t}},r.prototype.stub=function(){},h.prototype.initStorage=function(){this._storage=new r,this.getHistory().forEach(function(t){this.output.appendChild(this.getItemElem.apply(this,t))},this),this.guess.value=this._storage.get("guess")||""},h.prototype.initComponents=function(){this.form=document.forms.puzzle,this.guess=this.form.elements.guess,this.output=this.form.querySelector(".output"),this.form.addEventListener("submit",this.onFormSubmit.bind(this),!1),this.form.addEventListener("reset",this.reset.bind(this),!1),this.guess.addEventListener("keyup",this.saveGuess.bind(this),!1)},h.prototype.initGame=function(){this._game=new n(this._storage.get("secret")),this._storage.set("secret",this._game.getSecret())},h.prototype.onFormSubmit=function(t){var e=this.guess.value,i=this._game.check(e);return t.preventDefault(),i.invalid?void this.onInvalidInput(i.invalid):(this.isUiFrozen()||this.addItem(e,i),void(i.win&&this.onWin()))},h.prototype.onInvalidInput=function(t){alert("The guess "+t+" is invalid")},h.prototype.onWin=function(){this.reachGoal("GAME_WIN",{attempts:this.getHistory().length}),confirm("You win! Start a new game?")?(this.clear(),this.initGame()):this.freezeUi()},h.prototype.saveGuess=function(){this._storage.set("guess",this.guess.value.replace(/\s+/g,""))},h.prototype.reset=function(){this.clear(),this.initGame(),this.reachGoal("RESET")},h.prototype.clear=function(){this.output.innerHTML="",this.guess.value="",this._storage.clear()},h.prototype.addItem=function(t,e){var i=this.getHistory();i.unshift([t,e]),this.saveHistory(i),this.output.insertBefore(this.getItemElem(t,e),this.output.firstChild)},h.prototype.getItemElem=function(t,e){var i=document.createElement("li");return i.innerHTML=t+": "+e.bulls+"b "+e.cows+"c",i},h.prototype.freezeUi=function(){this._frozen=!0},h.prototype.isUiFrozen=function(){return Boolean(this._frozen)},h.prototype.getHistory=function(){var t;try{t=JSON.parse(this._storage.get("history"))}catch(e){t=[]}return[].concat(t).filter(Boolean)},h.prototype.saveHistory=function(t){this._storage.set("history",JSON.stringify(t.filter(Boolean)))},h.prototype.reachGoal=function(){var e=t.yaCounter32909025;e.reachGoal.apply(e,arguments)},t.UI=h}(window);